    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --bg: #0f172a;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text: #f8fafc;
            --accent: #818cf8;
            --danger: #ef4444;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: radial-gradient(circle at top left, #1e293b, #0f172a);
            color: var(--text);
            min-height: 100vh;
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.8rem;
            font-weight: 800;
            margin: 0;
            background: linear-gradient(to right, #818cf8, #c084fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            background: var(--glass);
            padding: 6px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            width: fit-content;
        }

        .tab-btn {
            padding: 10px 24px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            border: none;
            background: transparent;
            color: #94a3b8;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .section {
            display: none;
            background: var(--glass);
            backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .section.active {
            display: block;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Account Cards */
        .account-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .account-card.primary {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
            position: relative;
        }

        .account-card.primary::before {
            content: 'GLOBAL PRIMARY';
            position: absolute;
            top: -10px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 2px 12px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 800;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: #f8fafc;
            border-color: var(--glass-border);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border-color: rgba(239, 68, 68, 0.2);
        }

        /* Form Controls */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #94a3b8;
        }

        input, textarea, select {
            width: 100%;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px;
            color: white;
            font-family: inherit;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        textarea {
            height: 150px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        /* Documentation styles */
        .doc-endpoint {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid var(--glass-border);
        }

        .method {
            background: #10b981;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 800;
            font-size: 0.8rem;
            margin-right: 10px;
        }

        code {
            background: rgba(0,0,0,0.3);
            color: var(--accent);
            padding: 4px 8px;
            border-radius: 6px;
            font-family: monospace;
        }

        pre {
            background: #000;
            padding: 20px;
            border-radius: 16px;
            overflow-x: auto;
            border: 1px solid var(--glass-border);
            margin: 15px 0;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            position: relative;
        }

        .status-dot.active { background: #10b981; box-shadow: 0 0 10px #10b981; }
        .status-dot.active::after {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            background: inherit; border-radius: inherit;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(3); opacity: 0; }
        }

        #test-result {
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Zoho Proxy Platform</h1>
            <a href="{% url 'zoho_login' %}" class="btn btn-primary">+ Add Account</a>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="showSection('accounts', this)">Accounts</button>
            <button class="tab-btn" onclick="showSection('docs', this)">Developer Docs</button>
            <button class="tab-btn" onclick="showSection('tester', this)">API Tester</button>
        </div>

        <!-- Accounts Section -->
        <section id="accounts" class="section active">
            <div class="card-list">
                {% for account in accounts %}
                <div class="account-card {% if account.is_primary %}primary{% endif %}">
                    <div>
                        <div style="font-weight: 700; font-size: 1.4rem; color: #fff; margin-bottom: 4px;">{{ account.account_name }}</div>
                        <div style="font-size: 0.85rem; display: flex; align-items: center; gap: 8px; color: #94a3b8;">
                            <span class="status-dot {% if account.is_primary %}active{% endif %}"></span>
                            <span style="color: {% if account.is_primary %}#10b981{% endif %};">
                                {% if account.is_primary %}Live Gateway{% else %}Backup Standby{% endif %}
                            </span>
                            <span>| ID: {{ account.pk }}</span>
                            {% if account.tenant_id %}<span>| Tenant: {{ account.tenant_id }}</span>{% endif %}
                        </div>
                    </div>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <div style="text-align: right; margin-right: 15px;">
                            <div style="font-size: 0.75rem; color: #64748b;">EXPIRATION</div>
                            <div style="font-weight: 600; font-size: 0.9rem;">{{ account.expiry_time|timeuntil }}</div>
                        </div>
                        {% if not account.is_primary %}
                        <a href="{% url 'set_primary' account.pk %}" class="btn btn-secondary">Set Primary</a>
                        {% endif %}
                        <button class="btn btn-secondary" onclick="openConfigModal('{{ account.pk }}', '{{ account.tenant_id|default:'' }}', '{{ account.bookings_service_id|default:'' }}', '{{ account.bookings_staff_id|default:'' }}')">Config</button>
                        <a href="{% url 'delete_account' account.pk %}" class="btn btn-danger" onclick="return confirm('Disconnect this account?')">Disconnect</a>
                    </div>
                </div>
                {% empty %}
                <div style="text-align: center; padding: 60px; color: #64748b;">
                    No accounts connected. Connect your first Zoho account to start.
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Docs Section -->
        <section id="docs" class="section">
            <div class="doc-endpoint">
                <h2><span class="method">POST</span> <code>/api/leads/</code></h2>
                <p>Creates a lead in the primary Zoho CRM account. Handles dynamic field creation automatically.</p>
                
                <h3>Payload Specification</h3>
                <pre>{
  "First_Name": "String (Optional)",
  "Last_Name": "String (Required)",
  "Email": "String (Email Format)",
  "Company": "String (Required)",
  "Any_Custom_Field": "Any data - auto-creates field if missing"
}</pre>
                
                <h3>Response Structure</h3>
                <pre>{
  "lead_id": "Zoho_ID_123",
  "account": "Linked Account Name",
  "status": 201,
  "response": { "original_zoho_response": "..." }
}</pre>
            </div>

            <div class="doc-endpoint">
                <h2><span class="method">POST</span> <code>/api/bookings/</code></h2>
                <p>Handles appointment scheduling. If the requested slot is busy, it automatically discovers alternative slots.</p>
                
                <h3>Payload Specification</h3>
                <pre>{
  "date": "YYYY-MM-DD (e.g., 2026-02-15)",
  "time": "HH:MM (24h format, e.g., 14:30)",
  "name": "Customer Name",
  "email": "Customer Email",
  "phone": "Customer Phone",
  "tenant_id": "Optional - targeted account selection"
}</pre>

                <h3>Response Scenarios</h3>
                
                <div style="margin-top: 15px;">
                    <strong style="color: #10b981;">Scenario A: Success (Booking Confirmed)</strong>
                    <pre>{
  "status": "booking done",
  "booking_id": "#SC-00144",
  "details": {
    "booking_id": "#SC-00144",
    "service_name": "30 Mins Meeting",
    "staff_name": "Prem Anand",
    "start_time": "07-Feb-2026 14:00:00",
    "end_time": "07-Feb-2026 14:30:00",
    "customer_name": "Test User",
    "customer_email": "user@test.local",
    "time_zone": "Asia/Kolkata"
  }
}</pre>
                </div>

                <div style="margin-top: 15px;">
                    <strong style="color: #fbbf24;">Scenario B: Slot Unavailable (Auto-Discovery)</strong>
                    <p style="font-size: 0.85rem; color: #94a3b8; margin: 5px 0;">If the slot is taken, the proxy automatically scans your calendar for the next 7 days and returns all free slots.</p>
                    <pre>{
  "status": "slot unavailable",
  "message": "The requested slot was taken. Here are available slots for 07-Feb-2026",
  "date": "2026-02-07",
  "available_slots": ["01:15 PM", "01:30 PM", "02:30 PM", "02:45 PM", "03:00 PM"]
}</pre>
                </div>
            </div>

            <div class="doc-endpoint">
                <h2><span class="method" style="background: #3b82f6;">GET / POST</span> <code>/api/leads/get/</code></h2>
                <p>Retrieves full lead data from Zoho using the Lead ID, Email, or Phone number.</p>
                
                <h3>Response Structure</h3>
                <pre>{
  "status": "success",
  "account": "Linked Account Name",
  "data": {
    "id": "Zoho_ID_123",
    "First_Name": "Test",
    "Last_Name": "Developer",
    "Email": "dev@test.local",
    "Lead_Source": "Proxy"
  }
}</pre>
            </div>
        </section>

        <!-- Tester Section -->
        <section id="tester" class="section">
            <div style="display: flex; gap: 40px;">
                <div style="flex: 1;">
                    <h2>API Playground</h2>
                    <p style="color: #94a3b8; margin-bottom: 30px;">Choose an endpoint and send a real request to your proxy.</p>
                    
                    <label>Endpoint</label>
                    <select id="test-endpoint" onchange="updateSamplePayload()">
                        <option value="/api/leads/">Create CRM Lead (leads/)</option>
                        <option value="/api/leads/get/">Retrieve Lead (leads/get/)</option>
                        <option value="/api/bookings/">Create Appointment (bookings/)</option>
                    </select>

                    <label>JSON Payload</label>
                    <textarea id="test-payload"></textarea>

                    <button class="btn btn-primary" style="width: 100%; justify-content: center; margin-top: 20px;" onclick="runTest()">
                        Send Request &rsaquo;
                    </button>
                </div>
                
                <div style="flex: 1;">
                    <label>Server Response</label>
                    <div id="test-loader" style="display:none; text-align: center; padding: 40px;">
                        <div class="status-dot active"></div> Processing...
                    </div>
                    <pre id="test-output" style="height: 380px; margin: 0; background: #000; border-color: var(--primary);">/* Response will appear here after execution */</pre>
                </div>
            </div>
        </section>

    <!-- Config Modal -->
    <div id="config-modal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 1000; align-items: center; justify-content: center;">
        <div class="section" style="width: 100%; max-width: 500px; display: block;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin:0;">Account Configuration</h2>
                <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.75rem;" onclick="fetchZohoMetadata()">
                    ðŸ”„ Auto-Fetch from Zoho
                </button>
            </div>
            
            <p style="color: #94a3b8; margin-bottom: 20px; font-size: 0.9rem;">Set global IDs for this account. You can enter them manually or use the fetch button to select from your Zoho account.</p>
            
            <input type="hidden" id="config-pk">
            
            <label>Tenant ID (Optional)</label>
            <input type="text" id="config-tenant" placeholder="e.g. client_abc">
            
            <div style="display: flex; gap: 15px;">
                <div style="flex:1;">
                    <label>Bookings Service ID</label>
                    <input type="text" id="config-service" placeholder="Paste ID or Fetch">
                    <select id="select-service" style="display:none; margin-top: -10px;" onchange="document.getElementById('config-service').value=this.value"></select>
                </div>
                <div style="flex:1;">
                    <label>Bookings Staff ID</label>
                    <input type="text" id="config-staff" placeholder="Paste ID or Fetch">
                    <select id="select-staff" style="display:none; margin-top: -10px;" onchange="document.getElementById('config-staff').value=this.value"></select>
                </div>
            </div>
            
            <div id="fetch-status" style="display:none; font-size: 0.8rem; color: #10b981; margin-bottom: 15px;">
               âœ… Data fetched successfully! Select from dropdowns below the inputs.
            </div>

            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-primary" style="flex: 1; justify-content: center;" onclick="saveConfig()">Save Settings</button>
                <button class="btn btn-secondary" style="flex: 1; justify-content: center;" onclick="closeConfigModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        async function fetchZohoMetadata() {
            const pk = document.getElementById('config-pk').value;
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "âŒ› Fetching...";
            
            try {
                const response = await fetch(`/account/metadata/${pk}/`);
                const data = await response.json();
                
                if (data.error) throw new Error(data.error);

                // Populate Services Select
                const sSelect = document.getElementById('select-service');
                sSelect.innerHTML = '<option value="">-- Select Service --</option>';
                data.services.forEach(s => {
                    sSelect.innerHTML += `<option value="${s.id}">${s.name}</option>`;
                });
                sSelect.style.display = 'block';

                // Populate Staff Select
                const stSelect = document.getElementById('select-staff');
                stSelect.innerHTML = '<option value="">-- Select Staff --</option>';
                data.staff.forEach(s => {
                    stSelect.innerHTML += `<option value="${s.id}">${s.name}</option>`;
                });
                stSelect.style.display = 'block';

                document.getElementById('fetch-status').style.display = 'block';
            } catch (err) {
                alert("Error fetching from Zoho: " + err.message);
            } finally {
                btn.innerText = originalText;
            }
        }

        function openConfigModal(pk, tenant, service, staff) {
            document.getElementById('config-pk').value = pk;
            document.getElementById('config-tenant').value = tenant;
            document.getElementById('config-service').value = service;
            document.getElementById('config-staff').value = staff;
            
            // Reset selects
            document.getElementById('select-service').style.display = 'none';
            document.getElementById('select-staff').style.display = 'none';
            document.getElementById('fetch-status').style.display = 'none';
            
            document.getElementById('config-modal').style.display = 'flex';
        }

        function closeConfigModal() {
            document.getElementById('config-modal').style.display = 'none';
        }

        async function saveConfig() {
            const pk = document.getElementById('config-pk').value;
            const data = {
                tenant_id: document.getElementById('config-tenant').value,
                bookings_service_id: document.getElementById('config-service').value,
                bookings_staff_id: document.getElementById('config-staff').value,
            };

            const response = await fetch(`/account/update/${pk}/`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                location.reload();
            } else {
                alert("Failed to save configuration");
            }
        }

        function showSection(id, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        const payloads = {
            '/api/leads/': {
                "First_Name": "Test",
                "Last_Name": "Developer",
                "Email": "dev@test.local",
                "Company": "Sandbox Tech",
                "Source_App": "Proxy Explorer"
            },
            '/api/leads/get/': {
                "email": "dev@test.local",
                "phone": "+919876543210",
                "id": ""
            },
            '/api/bookings/': {
                "date": new Date().toISOString().split('T')[0],
                "time": "14:00",
                "name": "Test User",
                "email": "user@test.local",
                "phone": "+919876543210",
                "service_id": "{{ primary_account.bookings_service_id|default:'REPLACE_WITH_YOUR_SERVICE_ID' }}",
                "staff_id": "{{ primary_account.bookings_staff_id|default:'REPLACE_WITH_YOUR_STAFF_ID' }}"
            }
        };

        function updateSamplePayload() {
            const endpoint = document.getElementById('test-endpoint').value;
            document.getElementById('test-payload').value = JSON.stringify(payloads[endpoint], null, 4);
        }

        updateSamplePayload();

        async function runTest() {
            const endpoint = document.getElementById('test-endpoint').value;
            const payload = document.getElementById('test-payload').value;
            const output = document.getElementById('test-output');
            const loader = document.getElementById('test-loader');

            output.style.display = 'none';
            loader.style.display = 'block';

            try {
                let options = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: payload
                };

                const response = await fetch(endpoint, options);
                const data = await response.json();
                output.textContent = JSON.stringify(data, null, 4);
            } catch (err) {
                output.textContent = "Error: " + err.message;
            } finally {
                loader.style.display = 'none';
                output.style.display = 'block';
            }
        }
    </script>
</body>
</html>
